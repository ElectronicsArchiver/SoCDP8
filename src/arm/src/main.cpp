#include <cstdint>
#include <xscugic.h>
#include <xil_printf.h>
#include "xparameters.h"

#include "peripherals/TeleType.h"

uint8_t maindec[] = {
  0x80, 0x80, 0x80, 0x80, 0x80, 0x40, 0x10, 0x00, 0x00, 0x40, 0x11, 0x00,
  0x01, 0x40, 0x12, 0x00, 0x02, 0x40, 0x13, 0x00, 0x04, 0x40, 0x14, 0x00,
  0x08, 0x40, 0x15, 0x00, 0x10, 0x40, 0x16, 0x00, 0x20, 0x40, 0x17, 0x01,
  0x00, 0x40, 0x18, 0x02, 0x00, 0x40, 0x19, 0x04, 0x00, 0x40, 0x1a, 0x08,
  0x00, 0x40, 0x1b, 0x10, 0x00, 0x40, 0x1c, 0x20, 0x00, 0x40, 0x1d, 0x3f,
  0x3e, 0x40, 0x1e, 0x3f, 0x3d, 0x40, 0x1f, 0x3f, 0x3b, 0x40, 0x20, 0x3f,
  0x37, 0x40, 0x21, 0x3f, 0x2f, 0x40, 0x22, 0x3f, 0x1f, 0x40, 0x23, 0x3e,
  0x3f, 0x40, 0x24, 0x3d, 0x3f, 0x40, 0x25, 0x3b, 0x3f, 0x40, 0x26, 0x37,
  0x3f, 0x40, 0x27, 0x2f, 0x3f, 0x40, 0x28, 0x1f, 0x3f, 0x40, 0x29, 0x3f,
  0x3f, 0x40, 0x2a, 0x2a, 0x2a, 0x40, 0x2b, 0x15, 0x15, 0x40, 0x2c, 0x25,
  0x2f, 0x40, 0x2d, 0x07, 0x2a, 0x40, 0x2e, 0x05, 0x22, 0x40, 0x2f, 0x08,
  0x00, 0x40, 0x30, 0x0a, 0x00, 0x40, 0x31, 0x07, 0x1d, 0x40, 0x32, 0x12,
  0x07, 0x40, 0x33, 0x12, 0x0b, 0x40, 0x34, 0x12, 0x04, 0x40, 0x35, 0x12,
  0x00, 0x40, 0x36, 0x0a, 0x3e, 0x40, 0x37, 0x0b, 0x23, 0x40, 0x38, 0x05,
  0x32, 0x40, 0x39, 0x08, 0x29, 0x40, 0x3a, 0x13, 0x23, 0x40, 0x3b, 0x02,
  0x0c, 0x40, 0x3c, 0x1c, 0x3f, 0x40, 0x3d, 0x0e, 0x17, 0x40, 0x3e, 0x0e,
  0x00, 0x40, 0x3f, 0x12, 0x2c, 0x41, 0x00, 0x05, 0x05, 0x41, 0x01, 0x03,
  0x18, 0x41, 0x02, 0x10, 0x00, 0x41, 0x03, 0x05, 0x36, 0x41, 0x04, 0x07,
  0x15, 0x41, 0x05, 0x06, 0x0c, 0x41, 0x06, 0x07, 0x00, 0x41, 0x07, 0x06,
  0x00, 0x41, 0x08, 0x06, 0x06, 0x41, 0x09, 0x30, 0x00, 0x41, 0x0a, 0x3d,
  0x33, 0x41, 0x0b, 0x3d, 0x20, 0x41, 0x0c, 0x3d, 0x37, 0x41, 0x0d, 0x3d,
  0x1c, 0x41, 0x0e, 0x3d, 0x16, 0x41, 0x0f, 0x3d, 0x12, 0x41, 0x10, 0x3d,
  0x15, 0x41, 0x11, 0x3d, 0x13, 0x41, 0x12, 0x3d, 0x14, 0x41, 0x13, 0x3d,
  0x03, 0x41, 0x14, 0x26, 0x00, 0x41, 0x15, 0x37, 0x00, 0x41, 0x16, 0x00,
  0x3f, 0x41, 0x17, 0x00, 0x07, 0x41, 0x18, 0x25, 0x23, 0x41, 0x19, 0x3d,
  0x3c, 0x41, 0x1a, 0x01, 0x3f, 0x41, 0x1b, 0x25, 0x30, 0x41, 0x1c, 0x2d,
  0x1d, 0x41, 0x1d, 0x05, 0x1c, 0x41, 0x1e, 0x00, 0x29, 0x41, 0x1f, 0x08,
  0x0e, 0x41, 0x20, 0x08, 0x1a, 0x41, 0x21, 0x08, 0x19, 0x41, 0x22, 0x08,
  0x2d, 0x41, 0x23, 0x09, 0x03, 0x41, 0x24, 0x09, 0x18, 0x41, 0x25, 0x27,
  0x23, 0x41, 0x26, 0x00, 0x00, 0x41, 0x27, 0x00, 0x00, 0x41, 0x28, 0x00,
  0x00, 0x41, 0x29, 0x3f, 0x3f, 0x41, 0x2a, 0x00, 0x00, 0x41, 0x2b, 0x3f,
  0x3c, 0x41, 0x2c, 0x3f, 0x3f, 0x41, 0x2d, 0x3f, 0x3f, 0x41, 0x2e, 0x2f,
  0x37, 0x41, 0x2f, 0x02, 0x27, 0x41, 0x30, 0x1a, 0x09, 0x41, 0x31, 0x00,
  0x00, 0x41, 0x32, 0x00, 0x00, 0x41, 0x33, 0x00, 0x00, 0x41, 0x34, 0x00,
  0x00, 0x41, 0x35, 0x00, 0x00, 0x41, 0x36, 0x00, 0x00, 0x41, 0x37, 0x00,
  0x00, 0x41, 0x38, 0x00, 0x0e, 0x41, 0x39, 0x25, 0x23, 0x41, 0x3a, 0x00,
  0x00, 0x41, 0x3b, 0x09, 0x0f, 0x41, 0x3c, 0x27, 0x33, 0x41, 0x3d, 0x00,
  0x00, 0x41, 0x3e, 0x00, 0x0a, 0x41, 0x3f, 0x3f, 0x3f, 0x42, 0x00, 0x3c,
  0x02, 0x42, 0x01, 0x3c, 0x04, 0x42, 0x02, 0x3c, 0x02, 0x42, 0x03, 0x3c,
  0x04, 0x42, 0x04, 0x3a, 0x00, 0x42, 0x05, 0x3c, 0x02, 0x42, 0x06, 0x3c,
  0x08, 0x42, 0x07, 0x3c, 0x02, 0x42, 0x08, 0x3e, 0x04, 0x42, 0x09, 0x3d,
  0x00, 0x42, 0x0a, 0x3c, 0x02, 0x42, 0x0b, 0x3a, 0x00, 0x42, 0x0c, 0x3d,
  0x00, 0x42, 0x0d, 0x3c, 0x08, 0x42, 0x0e, 0x3c, 0x02, 0x42, 0x0f, 0x3a,
  0x00, 0x42, 0x10, 0x3d, 0x08, 0x42, 0x11, 0x3c, 0x02, 0x42, 0x12, 0x3e,
  0x04, 0x42, 0x13, 0x3d, 0x08, 0x42, 0x14, 0x3c, 0x08, 0x42, 0x15, 0x3c,
  0x02, 0x42, 0x16, 0x3b, 0x00, 0x42, 0x17, 0x3c, 0x20, 0x42, 0x18, 0x3c,
  0x02, 0x42, 0x19, 0x3e, 0x04, 0x42, 0x1a, 0x3c, 0x20, 0x42, 0x1b, 0x3c,
  0x08, 0x42, 0x1c, 0x3c, 0x02, 0x42, 0x1d, 0x3e, 0x04, 0x42, 0x1e, 0x3c,
  0x28, 0x42, 0x1f, 0x3c, 0x02, 0x42, 0x20, 0x3a, 0x00, 0x42, 0x21, 0x3c,
  0x28, 0x42, 0x22, 0x3c, 0x08, 0x42, 0x23, 0x3c, 0x02, 0x42, 0x24, 0x3c,
  0x18, 0x42, 0x25, 0x3c, 0x02, 0x42, 0x26, 0x39, 0x10, 0x42, 0x27, 0x3c,
  0x18, 0x42, 0x28, 0x3c, 0x08, 0x42, 0x29, 0x3c, 0x02, 0x42, 0x2a, 0x39,
  0x10, 0x42, 0x2b, 0x3c, 0x10, 0x42, 0x2c, 0x3c, 0x02, 0x42, 0x2d, 0x39,
  0x10, 0x42, 0x2e, 0x39, 0x00, 0x42, 0x2f, 0x3c, 0x18, 0x42, 0x30, 0x3c,
  0x02, 0x42, 0x31, 0x39, 0x00, 0x42, 0x32, 0x3c, 0x10, 0x42, 0x33, 0x3c,
  0x08, 0x42, 0x34, 0x3c, 0x02, 0x42, 0x35, 0x39, 0x00, 0x42, 0x36, 0x38,
  0x10, 0x42, 0x37, 0x3c, 0x10, 0x42, 0x38, 0x3c, 0x02, 0x42, 0x39, 0x39,
  0x10, 0x42, 0x3a, 0x38, 0x10, 0x42, 0x3b, 0x3c, 0x18, 0x42, 0x3c, 0x3c,
  0x02, 0x42, 0x3d, 0x3e, 0x04, 0x42, 0x3e, 0x38, 0x20, 0x42, 0x3f, 0x3c,
  0x20, 0x43, 0x00, 0x3c, 0x02, 0x43, 0x01, 0x3e, 0x04, 0x43, 0x02, 0x38,
  0x01, 0x43, 0x03, 0x3c, 0x20, 0x43, 0x04, 0x3c, 0x02, 0x43, 0x05, 0x3a,
  0x00, 0x43, 0x06, 0x38, 0x20, 0x43, 0x07, 0x38, 0x01, 0x43, 0x08, 0x3c,
  0x20, 0x43, 0x09, 0x3c, 0x02, 0x43, 0x0a, 0x3a, 0x00, 0x43, 0x0b, 0x3a,
  0x20, 0x43, 0x0c, 0x38, 0x20, 0x43, 0x0d, 0x3c, 0x20, 0x43, 0x0e, 0x3c,
  0x02, 0x43, 0x0f, 0x3a, 0x00, 0x43, 0x10, 0x38, 0x21, 0x43, 0x11, 0x3c,
  0x20, 0x43, 0x12, 0x3c, 0x02, 0x43, 0x13, 0x3b, 0x20, 0x43, 0x14, 0x38,
  0x01, 0x43, 0x15, 0x3c, 0x10, 0x43, 0x16, 0x3c, 0x02, 0x43, 0x17, 0x3c,
  0x08, 0x43, 0x18, 0x3f, 0x3f, 0x43, 0x19, 0x3a, 0x20, 0x43, 0x1a, 0x03,
  0x18, 0x43, 0x1b, 0x38, 0x20, 0x43, 0x1c, 0x3c, 0x20, 0x43, 0x1d, 0x3c,
  0x02, 0x43, 0x1e, 0x3a, 0x00, 0x43, 0x1f, 0x03, 0x18, 0x43, 0x20, 0x3c,
  0x20, 0x43, 0x21, 0x3c, 0x02, 0x43, 0x22, 0x3c, 0x08, 0x43, 0x23, 0x00,
  0x00, 0x43, 0x24, 0x3a, 0x00, 0x43, 0x25, 0x03, 0x23, 0x43, 0x26, 0x3c,
  0x20, 0x43, 0x27, 0x3c, 0x02, 0x43, 0x28, 0x3a, 0x20, 0x43, 0x29, 0x03,
  0x23, 0x43, 0x2a, 0x3c, 0x20, 0x43, 0x2b, 0x3c, 0x02, 0x43, 0x2c, 0x3a,
  0x00, 0x43, 0x2d, 0x0b, 0x23, 0x43, 0x2e, 0x3c, 0x20, 0x43, 0x2f, 0x3c,
  0x02, 0x43, 0x30, 0x3a, 0x20, 0x43, 0x31, 0x0b, 0x23, 0x43, 0x32, 0x38,
  0x20, 0x43, 0x33, 0x3c, 0x20, 0x43, 0x34, 0x3c, 0x02, 0x43, 0x35, 0x38,
  0x00, 0x43, 0x36, 0x38, 0x00, 0x43, 0x37, 0x38, 0x00, 0x43, 0x38, 0x38,
  0x00, 0x43, 0x39, 0x38, 0x00, 0x43, 0x3a, 0x38, 0x00, 0x43, 0x3b, 0x38,
  0x00, 0x43, 0x3c, 0x38, 0x00, 0x43, 0x3d, 0x38, 0x00, 0x43, 0x3e, 0x38,
  0x00, 0x43, 0x3f, 0x38, 0x00, 0x44, 0x00, 0x3a, 0x00, 0x44, 0x01, 0x0a,
  0x06, 0x44, 0x02, 0x38, 0x20, 0x44, 0x03, 0x3c, 0x20, 0x44, 0x04, 0x3c,
  0x02, 0x44, 0x05, 0x3c, 0x08, 0x44, 0x06, 0x3f, 0x3f, 0x44, 0x07, 0x3a,
  0x20, 0x44, 0x08, 0x39, 0x00, 0x44, 0x09, 0x0a, 0x06, 0x44, 0x0a, 0x3c,
  0x10, 0x44, 0x0b, 0x3c, 0x02, 0x44, 0x0c, 0x38, 0x01, 0x44, 0x0d, 0x38,
  0x20, 0x44, 0x0e, 0x3c, 0x20, 0x44, 0x0f, 0x3c, 0x02, 0x44, 0x10, 0x3a,
  0x20, 0x44, 0x11, 0x1a, 0x19, 0x44, 0x12, 0x3c, 0x20, 0x44, 0x13, 0x3c,
  0x02, 0x44, 0x14, 0x0a, 0x19, 0x44, 0x15, 0x38, 0x20, 0x44, 0x16, 0x3c,
  0x20, 0x44, 0x17, 0x3c, 0x02, 0x44, 0x18, 0x3c, 0x08, 0x44, 0x19, 0x00,
  0x00, 0x44, 0x1a, 0x3a, 0x00, 0x44, 0x1b, 0x1a, 0x20, 0x44, 0x1c, 0x0a,
  0x20, 0x44, 0x1d, 0x3c, 0x20, 0x44, 0x1e, 0x3c, 0x02, 0x44, 0x1f, 0x3c,
  0x08, 0x44, 0x20, 0x3f, 0x3f, 0x44, 0x21, 0x12, 0x24, 0x44, 0x22, 0x3c,
  0x02, 0x44, 0x23, 0x3c, 0x08, 0x44, 0x24, 0x3f, 0x3f, 0x44, 0x25, 0x12,
  0x29, 0x44, 0x26, 0x3c, 0x08, 0x44, 0x27, 0x3c, 0x02, 0x44, 0x28, 0x3c,
  0x08, 0x44, 0x29, 0x00, 0x00, 0x44, 0x2a, 0x2a, 0x2d, 0x44, 0x2b, 0x3c,
  0x02, 0x44, 0x2c, 0x3c, 0x08, 0x44, 0x2d, 0x2a, 0x2c, 0x44, 0x2e, 0x3a,
  0x20, 0x44, 0x2f, 0x22, 0x31, 0x44, 0x30, 0x3c, 0x02, 0x44, 0x31, 0x00,
  0x00, 0x44, 0x32, 0x38, 0x01, 0x44, 0x33, 0x3c, 0x20, 0x44, 0x34, 0x3c,
  0x02, 0x44, 0x35, 0x22, 0x36, 0x44, 0x36, 0x00, 0x00, 0x44, 0x37, 0x3a,
  0x20, 0x44, 0x38, 0x0a, 0x36, 0x44, 0x39, 0x3c, 0x28, 0x44, 0x3a, 0x3c,
  0x02, 0x44, 0x3b, 0x3c, 0x08, 0x44, 0x3c, 0x04, 0x3d, 0x44, 0x3d, 0x22,
  0x3e, 0x44, 0x3e, 0x00, 0x00, 0x44, 0x3f, 0x3a, 0x00, 0x45, 0x00, 0x0a,
  0x3c, 0x45, 0x01, 0x38, 0x21, 0x45, 0x02, 0x0a, 0x3e, 0x45, 0x03, 0x3c,
  0x28, 0x45, 0x04, 0x3c, 0x02, 0x45, 0x05, 0x3c, 0x08, 0x45, 0x06, 0x03,
  0x18, 0x45, 0x07, 0x3a, 0x20, 0x45, 0x08, 0x07, 0x06, 0x45, 0x09, 0x38,
  0x20, 0x45, 0x0a, 0x3c, 0x20, 0x45, 0x0b, 0x3c, 0x02, 0x45, 0x0c, 0x2f,
  0x0e, 0x45, 0x0d, 0x2b, 0x10, 0x45, 0x0e, 0x05, 0x0d, 0x45, 0x0f, 0x3c,
  0x02, 0x45, 0x10, 0x27, 0x13, 0x45, 0x11, 0x00, 0x00, 0x45, 0x12, 0x2b,
  0x15, 0x45, 0x13, 0x05, 0x11, 0x45, 0x14, 0x3c, 0x02, 0x45, 0x15, 0x3a,
  0x20, 0x45, 0x16, 0x00, 0x29, 0x45, 0x17, 0x38, 0x20, 0x45, 0x18, 0x3c,
  0x20, 0x45, 0x19, 0x3c, 0x02, 0x45, 0x1a, 0x29, 0x1c, 0x45, 0x1b, 0x3c,
  0x02, 0x45, 0x1c, 0x3a, 0x20, 0x45, 0x1d, 0x05, 0x1e, 0x45, 0x1e, 0x38,
  0x20, 0x45, 0x1f, 0x3c, 0x20, 0x45, 0x20, 0x3c, 0x02, 0x45, 0x21, 0x3b,
  0x00, 0x45, 0x22, 0x38, 0x04, 0x45, 0x23, 0x3c, 0x20, 0x45, 0x24, 0x3c,
  0x02, 0x45, 0x25, 0x3a, 0x20, 0x45, 0x26, 0x39, 0x10, 0x45, 0x27, 0x38,
  0x04, 0x45, 0x28, 0x38, 0x20, 0x45, 0x29, 0x3c, 0x20, 0x45, 0x2a, 0x3c,
  0x02, 0x45, 0x2b, 0x3c, 0x10, 0x45, 0x2c, 0x3c, 0x02, 0x45, 0x2d, 0x3b,
  0x10, 0x45, 0x2e, 0x08, 0x2a, 0x45, 0x2f, 0x38, 0x04, 0x45, 0x30, 0x08,
  0x2a, 0x45, 0x31, 0x38, 0x20, 0x45, 0x32, 0x3c, 0x20, 0x45, 0x33, 0x3c,
  0x02, 0x45, 0x34, 0x12, 0x19, 0x45, 0x35, 0x38, 0x00, 0x45, 0x36, 0x12,
  0x20, 0x45, 0x37, 0x38, 0x00, 0x45, 0x38, 0x3a, 0x20, 0x45, 0x39, 0x1a,
  0x24, 0x45, 0x3a, 0x1a, 0x29, 0x45, 0x3b, 0x38, 0x00, 0x45, 0x3c, 0x38,
  0x00, 0x45, 0x3d, 0x38, 0x00, 0x45, 0x3e, 0x38, 0x00, 0x45, 0x3f, 0x3b,
  0x00, 0x46, 0x00, 0x08, 0x2b, 0x46, 0x01, 0x38, 0x04, 0x46, 0x02, 0x08,
  0x2b, 0x46, 0x03, 0x38, 0x20, 0x46, 0x04, 0x3c, 0x20, 0x46, 0x05, 0x3c,
  0x02, 0x46, 0x06, 0x3b, 0x00, 0x46, 0x07, 0x38, 0x06, 0x46, 0x08, 0x3c,
  0x20, 0x46, 0x09, 0x3c, 0x02, 0x46, 0x0a, 0x3a, 0x20, 0x46, 0x0b, 0x39,
  0x10, 0x46, 0x0c, 0x38, 0x04, 0x46, 0x0d, 0x38, 0x20, 0x46, 0x0e, 0x3c,
  0x30, 0x46, 0x0f, 0x3c, 0x02, 0x46, 0x10, 0x3b, 0x10, 0x46, 0x11, 0x08,
  0x2a, 0x46, 0x12, 0x38, 0x06, 0x46, 0x13, 0x3c, 0x18, 0x46, 0x14, 0x3c,
  0x02, 0x46, 0x15, 0x0a, 0x1a, 0x46, 0x16, 0x38, 0x20, 0x46, 0x17, 0x3c,
  0x20, 0x46, 0x18, 0x3c, 0x02, 0x46, 0x19, 0x3c, 0x08, 0x46, 0x1a, 0x15,
  0x14, 0x46, 0x1b, 0x3b, 0x00, 0x46, 0x1c, 0x38, 0x08, 0x46, 0x1d, 0x3c,
  0x20, 0x46, 0x1e, 0x3c, 0x02, 0x46, 0x1f, 0x3a, 0x20, 0x46, 0x20, 0x39,
  0x10, 0x46, 0x21, 0x38, 0x08, 0x46, 0x22, 0x38, 0x20, 0x46, 0x23, 0x3c,
  0x30, 0x46, 0x24, 0x3c, 0x02, 0x46, 0x25, 0x3b, 0x10, 0x46, 0x26, 0x08,
  0x2a, 0x46, 0x27, 0x38, 0x08, 0x46, 0x28, 0x3c, 0x18, 0x46, 0x29, 0x3c,
  0x02, 0x46, 0x2a, 0x0a, 0x2f, 0x46, 0x2b, 0x38, 0x20, 0x46, 0x2c, 0x3c,
  0x20, 0x46, 0x2d, 0x3c, 0x02, 0x46, 0x2e, 0x3c, 0x08, 0x46, 0x2f, 0x0a,
  0x2a, 0x46, 0x30, 0x3b, 0x00, 0x46, 0x31, 0x38, 0x0a, 0x46, 0x32, 0x3c,
  0x20, 0x46, 0x33, 0x3c, 0x02, 0x46, 0x34, 0x3a, 0x20, 0x46, 0x35, 0x39,
  0x10, 0x46, 0x36, 0x38, 0x0a, 0x46, 0x37, 0x38, 0x20, 0x46, 0x38, 0x3c,
  0x30, 0x46, 0x39, 0x3c, 0x02, 0x46, 0x3a, 0x3b, 0x10, 0x46, 0x3b, 0x08,
  0x2a, 0x46, 0x3c, 0x38, 0x0a, 0x46, 0x3d, 0x3c, 0x10, 0x46, 0x3e, 0x3c,
  0x02, 0x46, 0x3f, 0x0b, 0x04, 0x47, 0x00, 0x38, 0x20, 0x47, 0x01, 0x3c,
  0x20, 0x47, 0x02, 0x3c, 0x02, 0x47, 0x03, 0x2b, 0x07, 0x47, 0x04, 0x25,
  0x15, 0x47, 0x05, 0x07, 0x05, 0x47, 0x06, 0x00, 0x00, 0x47, 0x07, 0x3a,
  0x00, 0x47, 0x08, 0x0b, 0x05, 0x47, 0x09, 0x18, 0x08, 0x47, 0x0a, 0x08,
  0x2a, 0x47, 0x0b, 0x1c, 0x08, 0x47, 0x0c, 0x0b, 0x06, 0x47, 0x0d, 0x08,
  0x2b, 0x47, 0x0e, 0x38, 0x20, 0x47, 0x0f, 0x3c, 0x20, 0x47, 0x10, 0x3c,
  0x02, 0x47, 0x11, 0x2b, 0x1b, 0x47, 0x12, 0x38, 0x00, 0x47, 0x13, 0x38,
  0x00, 0x47, 0x14, 0x38, 0x00, 0x47, 0x15, 0x38, 0x00, 0x47, 0x16, 0x38,
  0x00, 0x47, 0x17, 0x02, 0x0d, 0x47, 0x18, 0x02, 0x0a, 0x47, 0x19, 0x02,
  0x3f, 0x47, 0x1a, 0x03, 0x00, 0x47, 0x1b, 0x3a, 0x00, 0x47, 0x1c, 0x0b,
  0x17, 0x47, 0x1d, 0x38, 0x00, 0x47, 0x1e, 0x38, 0x00, 0x47, 0x1f, 0x30,
  0x26, 0x47, 0x20, 0x38, 0x00, 0x47, 0x21, 0x3a, 0x00, 0x47, 0x22, 0x0b,
  0x18, 0x47, 0x23, 0x30, 0x21, 0x47, 0x24, 0x2b, 0x23, 0x47, 0x25, 0x30,
  0x26, 0x47, 0x26, 0x38, 0x00, 0x47, 0x27, 0x3a, 0x00, 0x47, 0x28, 0x0b,
  0x19, 0x47, 0x29, 0x30, 0x21, 0x47, 0x2a, 0x2b, 0x29, 0x47, 0x2b, 0x30,
  0x26, 0x47, 0x2c, 0x38, 0x00, 0x47, 0x2d, 0x3a, 0x00, 0x47, 0x2e, 0x0b,
  0x1a, 0x47, 0x2f, 0x30, 0x21, 0x47, 0x30, 0x2b, 0x2f, 0x47, 0x31, 0x30,
  0x26, 0x47, 0x32, 0x38, 0x00, 0x47, 0x33, 0x3a, 0x00, 0x47, 0x34, 0x0b,
  0x19, 0x47, 0x35, 0x30, 0x21, 0x47, 0x36, 0x2b, 0x35, 0x47, 0x37, 0x30,
  0x26, 0x47, 0x38, 0x30, 0x21, 0x47, 0x39, 0x2b, 0x38, 0x47, 0x3a, 0x30,
  0x1a, 0x47, 0x3b, 0x38, 0x00, 0x47, 0x3c, 0x38, 0x00, 0x47, 0x3d, 0x38,
  0x00, 0x47, 0x3e, 0x38, 0x00, 0x47, 0x3f, 0x3c, 0x08, 0x48, 0x00, 0x2d,
  0x1f, 0x48, 0x01, 0x30, 0x02, 0x48, 0x02, 0x30, 0x22, 0x48, 0x03, 0x3a,
  0x00, 0x48, 0x04, 0x0a, 0x00, 0x48, 0x05, 0x18, 0x01, 0x48, 0x06, 0x08,
  0x29, 0x48, 0x07, 0x30, 0x26, 0x48, 0x08, 0x30, 0x21, 0x48, 0x09, 0x2a,
  0x08, 0x48, 0x0a, 0x30, 0x01, 0x48, 0x0b, 0x38, 0x00, 0x48, 0x0c, 0x3c,
  0x02, 0x48, 0x0d, 0x2d, 0x20, 0x48, 0x0e, 0x30, 0x02, 0x48, 0x0f, 0x30,
  0x22, 0x48, 0x10, 0x3a, 0x00, 0x48, 0x11, 0x0a, 0x0d, 0x48, 0x12, 0x18,
  0x01, 0x48, 0x13, 0x08, 0x29, 0x48, 0x14, 0x30, 0x26, 0x48, 0x15, 0x30,
  0x21, 0x48, 0x16, 0x2a, 0x15, 0x48, 0x17, 0x30, 0x01, 0x48, 0x18, 0x3a,
  0x00, 0x48, 0x19, 0x38, 0x00, 0x48, 0x1a, 0x0a, 0x19, 0x48, 0x1b, 0x38,
  0x20, 0x48, 0x1c, 0x09, 0x21, 0x48, 0x1d, 0x38, 0x01, 0x48, 0x1e, 0x3c,
  0x28, 0x48, 0x1f, 0x3c, 0x02, 0x48, 0x20, 0x3c, 0x08, 0x48, 0x21, 0x2d,
  0x22, 0x48, 0x22, 0x30, 0x02, 0x48, 0x23, 0x30, 0x22, 0x48, 0x24, 0x3a,
  0x00, 0x48, 0x25, 0x0a, 0x21, 0x48, 0x26, 0x18, 0x01, 0x48, 0x27, 0x08,
  0x29, 0x48, 0x28, 0x30, 0x26, 0x48, 0x29, 0x30, 0x21, 0x48, 0x2a, 0x2a,
  0x29, 0x48, 0x2b, 0x30, 0x01, 0x48, 0x2c, 0x3a, 0x00, 0x48, 0x2d, 0x08,
  0x00, 0x48, 0x2e, 0x38, 0x20, 0x48, 0x2f, 0x0a, 0x34, 0x48, 0x30, 0x38,
  0x01, 0x48, 0x31, 0x3c, 0x20, 0x48, 0x32, 0x3c, 0x02, 0x48, 0x33, 0x2a,
  0x36, 0x48, 0x34, 0x08, 0x2d, 0x48, 0x35, 0x2d, 0x23, 0x48, 0x36, 0x30,
  0x22, 0x48, 0x37, 0x3a, 0x00, 0x48, 0x38, 0x18, 0x00, 0x48, 0x39, 0x0a,
  0x35, 0x48, 0x3a, 0x18, 0x01, 0x48, 0x3b, 0x08, 0x29, 0x48, 0x3c, 0x30,
  0x01, 0x48, 0x3d, 0x38, 0x00, 0x48, 0x3e, 0x30, 0x02, 0x48, 0x3f, 0x30,
  0x26, 0x49, 0x00, 0x30, 0x21, 0x49, 0x01, 0x2b, 0x00, 0x49, 0x02, 0x3c,
  0x08, 0x49, 0x03, 0x3c, 0x02, 0x49, 0x04, 0x3a, 0x00, 0x49, 0x05, 0x08,
  0x1f, 0x49, 0x06, 0x18, 0x02, 0x49, 0x07, 0x0b, 0x17, 0x49, 0x08, 0x18,
  0x08, 0x49, 0x09, 0x0c, 0x08, 0x49, 0x0a, 0x30, 0x26, 0x49, 0x0b, 0x30,
  0x21, 0x49, 0x0c, 0x2b, 0x0b, 0x49, 0x0d, 0x10, 0x02, 0x49, 0x0e, 0x2b,
  0x15, 0x49, 0x0f, 0x2f, 0x10, 0x49, 0x10, 0x02, 0x06, 0x49, 0x11, 0x02,
  0x0d, 0x49, 0x12, 0x02, 0x0a, 0x49, 0x13, 0x00, 0x31, 0x49, 0x14, 0x38,
  0x00, 0x49, 0x15, 0x3a, 0x00, 0x49, 0x16, 0x2b, 0x09, 0x49, 0x17, 0x09,
  0x0f, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,
};

class PDP8Memory {
public:
    void write(uint16_t addr, uint16_t value) {
        mem[addr] = value;
    }

private:
    uint32_t *mem = reinterpret_cast<uint32_t *>(XPAR_SOCDP8_AXI_BRAM_BASEADDR);
};

void storeRIMLoader(PDP8Memory &mem) {
    // RIM: bit 7 always 0, bit 6 is addr flag, 5..0 is data
    // loc1, loc0, content1, content0
    mem.write(07756, 06032); // KCC         / clear keyboard flag and ac
    mem.write(07757, 06031); // KSF         / skip if keyboard flag
    mem.write(07760, 05357); // JMP 7757    / jmp -1
    mem.write(07761, 06036); // KRB         / clear ac, or AC with keyboard (8 bit), clear flag
    mem.write(07762, 07106); // CLL RTL     / clear link, rotate left 2
    mem.write(07763, 07006); // RTL         / rotate left 2
    mem.write(07764, 07510); // SPA         / skip if ac > 0
    mem.write(07765, 05357); // JMP 7757    / jmp back
    mem.write(07766, 07006); // RTL         / rotate left 2
    mem.write(07767, 06031); // KSF         / skip if keyboard flag
    mem.write(07770, 05367); // JMP 7767    / jmp -1
    mem.write(07771, 06034); // KRS         / or AC with keyboard (8 bit)
    mem.write(07772, 07420); // SNL         / skip if link
    mem.write(07773, 03776); // DCA I 7776  / store ac in [7776], clear ac
    mem.write(07774, 03376); // DCA 7776    / store cleared ac in 7776
    mem.write(07775, 05356); // JMP 7756
    mem.write(07776, 00000); // address
}

void onAssert(const char *file, s32 line) {
    xil_printf("Assertion failed in %s, line %d\n", file, line);
}

void onIRQ(void *t) {
    TeleType *tty = (TeleType *) t;
    tty->onInterrupt();
}

void setupIRQ(void *ptr) {
    XScuGic gic;
    XScuGic_Config *gicConfig = XScuGic_LookupConfig(XPAR_PS7_SCUGIC_0_DEVICE_ID);
    if (!gicConfig) {
        xil_printf("Couldn't load config\n");
        return;
    }

    if (XScuGic_CfgInitialize(&gic, gicConfig, gicConfig->CpuBaseAddress) != XST_SUCCESS) {
        xil_printf("Couldn't configure GIC\n");
        return;
    }

    if (XScuGic_Connect(&gic, XPAR_FABRIC_SOCDP8_IO_CONTROLLER_SOC_IRQ_INTR, onIRQ, ptr) != XST_SUCCESS) {
        xil_printf("Couldn't connect IRQ handler\n");
        return;
    }

    XScuGic_Enable(&gic, XPAR_FABRIC_SOCDP8_IO_CONTROLLER_SOC_IRQ_INTR);

    // Set mid priority and rising-edge trigger
    XScuGic_SetPriorityTriggerType(&gic, XPAR_FABRIC_SOCDP8_IO_CONTROLLER_SOC_IRQ_INTR, 0xA0, 3);

    Xil_ExceptionRegisterHandler(XIL_EXCEPTION_ID_INT, (Xil_ExceptionHandler) XScuGic_InterruptHandler, &gic);
    Xil_ExceptionEnable();
}

int main() {
    Xil_AssertSetCallback(onAssert);

    xil_printf("PDP-8/I " __TIME__ " starting...\n");

    PDP8Memory mem;
    storeRIMLoader(mem);

    mem.write(00000, 01007); // TAD 7
    mem.write(00001, 07421); // MQL
    mem.write(00002, 07405); // MUY
    mem.write(00003, 456); // data
    mem.write(00004, 07407); // DVI
    mem.write(00005, 1); // data

    mem.write(00007, 123); // data

    TeleType tty;
    tty.setReaderInput(maindec, sizeof(maindec));
    // setupIRQ(&tty);

    xil_printf("Ready\n");

    while (true) {
        //tty.onInterrupt();
    }
}
